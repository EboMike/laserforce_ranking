{% extends "base.html" %}
{% block title %}Viewing {{ player.codename }}{% endblock %}

{% block html_head %}

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/app.css">
</head>

<style type="text/css">
    .important {
        color: #336699;
    }

    .sidebar {
        margin: 0;
        padding: 0;
        width: 200px;
        background: linear-gradient(180deg, rgba(26, 26, 26, 0.95) 0%, rgba(26, 26, 26, 0.76) 100%);
        position: fixed;
        height: 100%;
        overflow: auto;
    }

    .sidebar a {
        display: block;
        color: white;
        padding: 16px;
        text-decoration: none;
    }

    .sidebar a.active {
        background-color: #0096FF;
        color: white;
    }

    .content {
        margin-top: 20px;
    }

    .userlist {
        border-radius: 15px;
        background: #1A1A1A;
        padding: 1rem;
        margin: auto;
        width: 70%;
        height: 90vh;
        margin-top: 20px;
    }

    .userlist-pos {
        border-radius: 10px;
        padding: 0.2rem;
        margin: 0.9rem;
        background: #262626;
        padding-bottom: 0.5rem;
    }

    .userlist-username-text {
        font-size: 1.5rem;
        position: relative;
        left: 0.75rem;
        bottom: 0.125rem;
    }

    .userlist-info-text {
        float: right;
        right: 0.25rem;
        top: 0.25rem;
        position: relative;
    }

    body {
        background-color: #121212;
    }

    h1 {
        margin-bottom: 0;
    }

    h3, h5 {
        margin-top: 0.75rem;
        margin-bottom: 0;
    }

    h1, h3, h5 {
        padding-left: 1rem;
        padding-right: 1rem;
    }
</style>

{% endblock %}

{% block content %}

<body>
    <div>
        <div class="userlist">
            <div style="float: left; margin-left: 0; margin-right: 0;">
                <span title="Codename"><h1 style="font-size: 50px;">{{ player.codename }}</h1></span>

                <span title="Player ID"><h3>{{ player.player_id }}</h3></span>
                <span title="IPL ID"><h5>{{ player.ipl_id }}</h5></span>
            </div>

            <div style="float: right; margin-left: 0; margin-right: 0; margin-top: 2.094rem;">
                <a href="http://www.iplaylaserforce.com/mission-stats/?t={{ player.ipl_id[1:] }}" target="_blank" rel="noopener noreferrer"><h3 style="color: #2fa4e7;">View on IPL</h3></a>
            </div>

            <div style="clear: both;"></div>
            
            <div style="float: left; padding-left: 5rem; padding-top: 5rem;">
                <div style="display: flex; float: left;">
                    <div class="btn">
                        <canvas id="sm5_teams" style="max-width:600px;"></canvas>
                        <span title="{{ (sm5_win_percent*100)|round(1) }}%"><p>SM5 Teams</p></span>
                    </div>
                    <div class="btn">
                        <canvas id="laserball_teams" style="max-width:600px;"></canvas>
                        <span title="{{ (laserball_win_percent*100)|round(1) }}%"><p>Laserball Teams</p></span>
                    </div>
                </div>
                
                <canvas class="inline-block" id="avg_role_score" style="max-width: 500px; float: left; clear: both;" height="200px"></canvas>
            </div>

            <div style="padding-right: 5rem; padding-top: 5rem;">
                <canvas class="inline-block" id="avg_role_score_radar" style="max-width: 500px; float: right;" height="275px"></canvas>
            </div>
        </div>
    </div>

    <script>
        Chart.defaults.global.defaultFontColor = "#FFFFFF";

        new Chart("sm5_teams", {
            type: "pie",
            // wins, inner
            data: {
                labels: ["Red", "Green", "Red Wins", "Green Wins"],
                datasets: [
                    {
                        backgroundColor: ["#b91d47", "#00aba9"],
                        data: [{{ red_teams_sm5 }}, {{ green_teams_sm5 }}]
                    },
                    {
                        backgroundColor: ["#000000", "#000000", "#b91d47", "#00aba9"],
                        data: [0, 0, {{ red_wins_sm5 }}, {{ green_wins_sm5}}]
                    }
                ]
            },


            options: {
                legend: {
                    display: false,
                    fullSize: false
                }
            }
        });

        new Chart("laserball_teams", {
            type: "pie",
            data: {
                labels: ["Red", "Blue"],
                datasets: [{
                backgroundColor: ["#b91d47", "#0047AB"],
                data: [{{ red_teams_laserball }}, {{ blue_teams_laserball }}]
                }]
            },
            options: {
                legend: {
                    display: false,
                    fullSize: false
                }
            }
        });

        new Chart("avg_role_score", {
            type: "bar",
            data: {
                labels: ["Commander", "Heavy", "Scout", "Ammo", "Medic"],
                datasets: [
                    {
                        label: "Player's Median Score",
                        data: {{ role_plot_data_player }},
                        backgroundColor: [
                            "rgb(50, 116, 161)",
                            "rgb(225, 129, 44)",
                            "rgb(58, 146, 58)",
                            "rgb(192, 61, 62)",
                            "rgb(147, 114, 178)"
                        ]
                    },
                    {
                        label: "World's Median Score",
                        data: {{ role_plot_data_world }},
                        backgroundColor: [
                            "rgb(50, 166, 161)",
                            "rgb(225, 179, 44)",
                            "rgb(58, 196, 58)",
                            "rgb(192, 121, 62)",
                            "rgb(147, 174, 178)"
                        ]
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    yAxes: [{
                        ticks:{
                            min: 0,
                        },
                        stacked: false,
                    }],
                    xAxes: {
                        gridLines: {
                            display: false,
                        },
                        stacked: false
                    },
                },
                plugins: {
                    legend: {
                        labels: {
                            color: "rgb(255, 255, 255)"
                        }
                    },
                    title: {
                        display: true,
                        text: "Median player score vs median world score"
                    }
                }
            }
        });

        // median score vs world radar chart

        new Chart("avg_role_score_radar", {
            type: "radar",
            data: {
                labels: ["Commander", "Heavy", "Scout", "Ammo", "Medic"],
                datasets: [
                    {
                        label: "Player's Median Score",
                        data: {{ role_plot_data_player }},
                        backgroundColor: "rgba(50, 116, 161, 0.5)"
                    },
                    {
                        label: "World's Median Score",
                        data: {{ role_plot_data_world }},
                        backgroundColor: "rgba(50, 166, 161, 0.5)"
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Median player score vs median world score"
                    }
                },
                scale: {
                    gridLines: {
                        color: "rgba(255, 255, 255, 0.75)"
                    },
                    ticks: {
                        display: false // Hides the labels in the middel (numbers)
                    },
                    pointLabels: {
                        fontSize: 12
                    }
                },
                elements: {
                    point: {
                        radius: 5
                    }
                }
            },
            plugins: [{

                beforeDraw: function(c) {
                    var legends = c.legend.legendItems;
                    legends.forEach(function(e) {
                        if (e.fillStyle = "rgba(50, 116, 161, 0.5)") {
                            e.fillStyle = "rgb(50, 116, 161)";
                        }
                        else if (e.fillStyle = "rgba(50, 166, 161, 0.5)") {
                            e.fillStyle = "rgb(50, 166, 161)";
                        }
                    });
                }

            }]
        });
    </script>
</body>

{% endblock %}